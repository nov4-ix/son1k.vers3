<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Son1kVers3 ‚Äî La Resistencia</title>
  
  <!-- SEO / Share / PWA -->
  <meta name="description" content="Son1kVers3: Genera m√∫sica, Ghost Studio y Archivo central. Lo imperfecto tambi√©n es sagrado.">
  <meta property="og:title" content="Son1kVers3 ‚Äî Resistencia sonora">
  <meta property="og:description" content="Texto‚ÜíM√∫sica, Ghost Studio, Archivo.">
  <meta name="theme-color" content="#0b0b0d">
  
  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui'] },
          colors: { 
            neon: '#00FFE7', 
            coal: '#0B0B0F', 
            haze: '#0f111a',
            'neon-purple': '#8b5cf6',
            'neon-blue': '#06b6d4' 
          },
          boxShadow: { glow: '0 0 40px rgba(0,255,231,.25)' }
        }
      }
    }
  </script>
  <style>
    * { box-sizing: border-box; }
    html { background: #0f111a !important; }
    body { background: #0f111a !important; color: #e4e4e7 !important; font-family: Inter, ui-sans-serif, system-ui !important; }
    
    .knob { 
      width: 80px; height: 80px; border-radius: 50%; position: relative; 
      background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
      cursor: pointer; transition: all 0.2s ease;
      border: 3px solid #333;
      margin: 0 auto;
      user-select: none;
    }
    .knob:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(0,255,231,.3); }
    .knob:focus-visible { 
      outline: 2px solid #00FFE7; 
      outline-offset: 2px; 
    }
    .knob::after { 
      content: ''; position: absolute; left: 50%; top: 10px; 
      width: 4px; height: 20px; background: #00FFE7; border-radius: 2px; 
      transform: translateX(-50%) rotate(var(--rotation, 0deg)); 
      box-shadow: 0 0 8px rgba(0,255,231,.8); 
      transition: transform 0.1s ease;
    }
    
    .knob-small { 
      width: 60px; height: 60px; 
    }
    .knob-small::after { 
      top: 8px; 
      width: 3px; height: 16px; 
    }
    
    .custom-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 8px;
      border-radius: 5px;
      background: linear-gradient(90deg, #333 0%, #00FFE7 var(--value, 50%), #333 var(--value, 50%));
      outline: none;
      opacity: 0.8;
      transition: opacity 0.2s;
    }
    
    .custom-slider:hover {
      opacity: 1;
    }
    
    .custom-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #00FFE7;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,255,231,.5);
    }
    
    .custom-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #00FFE7;
      cursor: pointer;
      border: none;
      box-shadow: 0 0 10px rgba(0,255,231,.5);
    }
    
    .text-neon { color: #00FFE7 !important; }
    .bg-neon { background-color: #00FFE7 !important; }
    .border-neon { border-color: #00FFE7 !important; }
    .shadow-glow { box-shadow: 0 0 40px rgba(0,255,231,.25) !important; }
    .bg-haze { background-color: #0f111a !important; }
    
    .tab-active { 
      background: linear-gradient(45deg, #00FFE7, #8b5cf6);
      color: #000;
    }
    
    .section-hidden { display: none; }
    
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-online { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .status-offline { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .status-processing { background: rgba(249, 115, 22, 0.2); color: #f97316; }
    
    .drop-zone {
      border: 2px dashed #333;
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.02);
    }
    
    .drop-zone.drag-over {
      border-color: #00FFE7;
      background: rgba(0,255,231,0.05);
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00FFE7, #8b5cf6);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 4px;
    }
    
    @keyframes pulse-neon {
      0%, 100% { box-shadow: 0 0 5px rgba(0,255,231,.5); }
      50% { box-shadow: 0 0 20px rgba(0,255,231,.8); }
    }
    
    .pulse-neon { animation: pulse-neon 2s infinite; }
    
    .btn:focus-visible {
      outline: 2px solid #00FFE7;
      outline-offset: 2px;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    @media (max-width: 768px) {
      .blur-3xl { filter: blur(16px); }
      .backdrop-blur-xl { backdrop-filter: blur(8px); }
    }
    
    @media (prefers-reduced-motion: reduce) {
      .pulse-neon { animation: none; }
      .transition { transition: none; }
      .knob::after { transition: none; }
    }
  </style>
</head>

<body class="antialiased overflow-x-hidden bg-haze">
  <!-- Audio player global -->
  <audio id="player" class="sr-only" aria-hidden="true"></audio>
  
  <!-- Toast container -->
  <div id="toast-area" class="fixed top-20 right-4 z-50 space-y-2" aria-live="polite" aria-atomic="true"></div>

  <!-- NAVEGACI√ìN -->
  <nav class="fixed top-0 left-0 right-0 z-50 bg-zinc-950/80 backdrop-blur-xl border-b border-white/10" role="navigation">
    <div class="mx-auto max-w-7xl px-4 flex items-center justify-between h-16">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-neon to-neon-purple flex items-center justify-center">
          <span class="text-xs font-bold text-black">S3</span>
        </div>
        <span class="text-xl font-bold text-neon">SON1KVERS3</span>
      </div>
      
      <!-- Status indicator -->
      <div id="backend-status" class="status-indicator status-offline">
        <div class="w-2 h-2 rounded-full bg-current"></div>
        <span>Conectando...</span>
      </div>
      
      <div class="flex space-x-6" role="tablist">
        <button class="nav-tab tab-active px-4 py-2 rounded-lg transition btn" 
                data-section="home" 
                role="tab" 
                aria-selected="true">Historia</button>
        <button class="nav-tab px-4 py-2 rounded-lg transition btn" 
                data-section="ghost-studio" 
                role="tab" 
                aria-selected="false">Ghost Studio</button>
        <button class="nav-tab px-4 py-2 rounded-lg transition btn" 
                data-section="generacion" 
                role="tab" 
                aria-selected="false">Generaci√≥n</button>
        <button class="nav-tab px-4 py-2 rounded-lg transition btn" 
                data-section="archivo" 
                role="tab" 
                aria-selected="false">Archivo</button>
      </div>
      
      <button id="entrarEstudio" class="bg-neon text-black px-6 py-2 rounded-lg font-semibold hover:bg-neon/90 transition btn">
        Entrar al Estudio
      </button>
    </div>
  </nav>

  <!-- SECCI√ìN HOME -->
  <section id="home" class="content-section min-h-screen pt-20 pb-10" aria-hidden="false">
    <div class="mx-auto max-w-7xl px-4 grid lg:grid-cols-2 gap-12 items-center min-h-[80vh]">
      <div class="space-y-8">
        <div class="space-y-2">
          <p class="text-sm font-medium text-zinc-400 tracking-widest uppercase">LA RESISTENCIA</p>
          <h1 class="text-4xl md:text-6xl font-bold leading-tight">
            Lo imperfecto tambi√©n<br>
            <span class="text-neon">es sagrado</span>
          </h1>
          <h2 class="text-2xl md:text-3xl text-zinc-300 mt-4">
            Componer con alma<br>
            en un mundo de<br>
            <span class="text-neon-purple">m√°quinas.</span>
          </h2>
        </div>
        
        <div class="flex space-x-4">
          <button id="entrarEstudioMain" class="bg-neon text-black px-8 py-3 rounded-lg font-semibold hover:bg-neon/90 transition shadow-glow btn">
            Entrar al Estudio
          </button>
          <button id="conocerUniverso" class="border border-white/20 px-8 py-3 rounded-lg hover:bg-white/5 transition btn">
            Conocer el Universo
          </button>
        </div>
        
        <p class="text-zinc-400 max-w-lg">
          Genera m√∫sica, clona voces cantadas, mezcla con calidad de estudio y guarda tu proceso en un archivo vivo. Bienvenido al Estudio Fantasma.
        </p>
      </div>
      
      <div class="relative">
        <div class="absolute -inset-10 -z-10 blur-3xl opacity-30" style="background: conic-gradient(from 45deg, rgba(0,255,231,.2), transparent, rgba(99,102,241,.2))"></div>
        <div class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl p-8 shadow-2xl">
          <div class="text-center mb-6">
            <h3 class="text-xl font-semibold mb-2">Controles de Expresividad</h3>
            <p class="text-sm text-zinc-400">Ajusta los par√°metros para crear tu sonido √∫nico</p>
          </div>
          
          <div class="grid grid-cols-3 gap-6 mb-8">
            <div class="text-center">
              <div class="knob" 
                   data-knob="expresividad" 
                   data-value="75"
                   role="slider"
                   tabindex="0"
                   aria-valuemin="0"
                   aria-valuemax="100"
                   aria-valuenow="75"
                   aria-label="Expresividad"></div>
              <p class="text-sm mt-2 text-zinc-400">Expresividad</p>
              <p class="text-xs text-neon font-mono" id="expresividadDisplay">75%</p>
            </div>
            <div class="text-center">
              <div class="knob" 
                   data-knob="creatividad" 
                   data-value="60"
                   role="slider"
                   tabindex="0"
                   aria-valuemin="0"
                   aria-valuemax="100"
                   aria-valuenow="60"
                   aria-label="Creatividad"></div>
              <p class="text-sm mt-2 text-zinc-400">Creatividad</p>
              <p class="text-xs text-neon font-mono" id="creatividadDisplay">60%</p>
            </div>
            <div class="text-center">
              <div class="knob" 
                   data-knob="precision" 
                   data-value="85"
                   role="slider"
                   tabindex="0"
                   aria-valuemin="0"
                   aria-valuemax="100"
                   aria-valuenow="85"
                   aria-label="Precisi√≥n"></div>
              <p class="text-sm mt-2 text-zinc-400">Precisi√≥n</p>
              <p class="text-xs text-neon font-mono" id="precisionDisplay">85%</p>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <button id="testRapido" class="rounded-lg border border-neon/30 text-neon px-4 py-3 hover:bg-neon/10 transition font-medium btn">
              Test R√°pido
            </button>
            <button id="generarPreview" class="rounded-lg bg-neon/10 border border-neon text-neon px-4 py-3 hover:bg-neon/20 transition font-medium btn">
              Generar Preview
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECCI√ìN GHOST STUDIO -->
  <section id="ghost-studio" class="content-section section-hidden min-h-screen pt-20 pb-10" aria-hidden="true">
    <div class="mx-auto max-w-7xl px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Ghost Studio</h2>
        <p class="text-zinc-400 max-w-2xl mx-auto">Workflow Maqueta ‚Üí Production: Sube tu demo y obt√©n una producci√≥n profesional con an√°lisis autom√°tico.</p>
        <div class="inline-flex items-center space-x-2 mt-4">
          <div class="w-3 h-3 bg-neon rounded-full pulse-neon"></div>
          <span class="text-sm text-neon">An√°lisis SSL/Neve Activo</span>
        </div>
      </div>
      
      <div class="max-w-6xl mx-auto">
        <!-- Maqueta Upload Section -->
        <div class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl p-8 mb-8">
          <div class="grid lg:grid-cols-2 gap-8">
            <div>
              <h3 class="text-xl font-semibold mb-4">Sube tu Maqueta</h3>
              <div class="drop-zone" id="maquetaDropZone">
                <div class="mb-4">
                  <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-neon/10 flex items-center justify-center">
                    <svg class="w-8 h-8 text-neon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                  </div>
                  <p class="text-lg font-medium mb-2">Arrastra tu maqueta aqu√≠</p>
                  <p class="text-sm text-zinc-400">Formatos: WAV, MP3, FLAC, AIFF, M4A</p>
                </div>
                <input type="file" class="hidden" id="maquetaUpload" accept="audio/*">
                <button class="bg-white/10 text-white px-6 py-3 rounded-lg border border-white/20 btn" onclick="document.getElementById('maquetaUpload').click()">
                  Seleccionar Archivo
                </button>
              </div>
              
              <!-- File info display -->
              <div id="fileInfo" class="hidden mt-4 p-4 bg-white/5 rounded-lg">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="font-medium" id="fileName"></p>
                    <p class="text-sm text-zinc-400" id="fileSize"></p>
                  </div>
                  <button class="text-red-400 hover:text-red-300 btn" id="removeFile">‚úï</button>
                </div>
              </div>
            </div>
            
            <div>
              <h3 class="text-xl font-semibold mb-4">Configuraci√≥n de Producci√≥n</h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-zinc-300 mb-2">Visi√≥n del Usuario</label>
                  <textarea 
                    class="w-full h-24 bg-zinc-900/50 border border-white/10 rounded-lg px-4 py-3 text-white resize-none"
                    placeholder="Ej: Quiero que suene m√°s √©pico, con m√°s cuerdas y que el vocal tenga m√°s presencia..."
                    id="visionUsuario"
                  ></textarea>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-zinc-300 mb-2">Preset de Producci√≥n</label>
                  <select class="w-full bg-zinc-900/50 border border-white/10 rounded-lg px-4 py-3 text-white" id="presetProduccion">
                    <option>SSL Console + Neve Mix</option>
                    <option>Vintage Analog</option>
                    <option>Modern Pop</option>
                    <option>Cinematic</option>
                    <option>Lo-Fi Aesthetic</option>
                  </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label class="text-sm text-zinc-400">Target LUFS</label>
                    <input type="range" class="custom-slider w-full" value="16" min="12" max="20" id="targetLUFS">
                    <p class="text-center text-xs text-neon mt-1" id="lufsDisplay">-16 LUFS</p>
                  </div>
                  <div>
                    <label class="text-sm text-zinc-400">Warmth</label>
                    <input type="range" class="custom-slider w-full" value="65" min="0" max="100" id="warmth">
                    <p class="text-center text-xs text-neon mt-1" id="warmthDisplay">65%</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="mt-8 text-center">
            <button id="procesarMaqueta" class="bg-neon text-black px-8 py-4 rounded-lg font-semibold text-lg hover:bg-neon/90 transition shadow-glow btn" disabled>
              Procesar Maqueta ‚Üí Production
            </button>
          </div>
        </div>
        
        <!-- Progress Section -->
        <div id="progressSection" class="hidden rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl p-8 mb-8">
          <h3 class="text-xl font-semibold mb-4">Procesando...</h3>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <p class="text-sm text-zinc-400 mt-2" id="progressText">Analizando maqueta...</p>
        </div>
        
        <!-- Analysis Results -->
        <div id="analysisResults" class="hidden rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl p-8 mb-8">
          <h3 class="text-xl font-semibold mb-6">An√°lisis Autom√°tico</h3>
          <div class="grid md:grid-cols-4 gap-6">
            <div class="text-center">
              <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-neon/10 flex items-center justify-center">
                <span class="text-2xl">ü•Å</span>
              </div>
              <p class="text-sm text-zinc-400">Tempo</p>
              <p class="text-lg font-semibold text-neon" id="tempoValue">-- BPM</p>
            </div>
            <div class="text-center">
              <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-neon/10 flex items-center justify-center">
                <span class="text-2xl">üéπ</span>
              </div>
              <p class="text-sm text-zinc-400">Clave</p>
              <p class="text-lg font-semibold text-neon" id="keyValue">--</p>
            </div>
            <div class="text-center">
              <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-neon/10 flex items-center justify-center">
                <span class="text-2xl">‚ö°</span>
              </div>
              <p class="text-sm text-zinc-400">Energ√≠a</p>
              <p class="text-lg font-semibold text-neon" id="energyValue">--%</p>
            </div>
            <div class="text-center">
              <div class="w-16 h-16 mx-auto mb-2 rounded-full bg-neon/10 flex items-center justify-center">
                <span class="text-2xl">üé§</span>
              </div>
              <p class="text-sm text-zinc-400">Vocal</p>
              <p class="text-lg font-semibold text-neon" id="vocalValue">--</p>
            </div>
          </div>
        </div>
        
        <!-- A/B Comparison -->
        <div id="abComparison" class="hidden rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl p-8">
          <h3 class="text-xl font-semibold mb-6">Comparaci√≥n A/B</h3>
          <div class="grid md:grid-cols-2 gap-8">
            <div class="text-center">
              <h4 class="text-lg font-medium mb-4">Maqueta Original</h4>
              <div class="h-20 bg-white/5 rounded-lg flex items-center justify-center mb-4" id="originalWaveform">
                <span class="text-zinc-400">Waveform Original</span>
              </div>
              <button class="bg-white/10 text-white px-6 py-2 rounded-lg btn" id="playOriginal">
                ‚ñ∂ Reproducir Original
              </button>
            </div>
            <div class="text-center">
              <h4 class="text-lg font-medium mb-4">Producci√≥n Final</h4>
              <div class="h-20 bg-neon/10 rounded-lg flex items-center justify-center mb-4" id="productionWaveform">
                <span class="text-neon">Waveform Procesado</span>
              </div>
              <div class="flex space-x-2 justify-center">
                <button class="bg-neon/20 text-neon px-4 py-2 rounded-lg btn" id="playProduction">
                  ‚ñ∂ Reproducir Production
                </button>
                <button class="bg-neon text-black px-4 py-2 rounded-lg btn" id="downloadProduction">
                  ‚¨á Descargar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECCI√ìN GENERACI√ìN -->
  <section id="generacion" class="content-section section-hidden min-h-screen pt-20 pb-10" aria-hidden="true">
    <div class="mx-auto max-w-7xl px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Generaci√≥n Musical</h2>
        <p class="text-zinc-400 max-w-2xl mx-auto">Genera m√∫sica desde texto con controles profesionales de expresividad y postprocesamiento SSL/Neve.</p>
      </div>
      
      <div class="max-w-6xl mx-auto">
        <div class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl p-8">
          <div class="grid lg:grid-cols-2 gap-8">
            <div class="space-y-6">
              <div>
                <label class="block text-sm font-medium text-zinc-300 mb-2">Letra de la canci√≥n</label>
                <textarea 
                  class="w-full h-32 bg-zinc-900/50 border border-white/10 rounded-lg px-4 py-3 text-white resize-none"
                  placeholder="Escribe aqu√≠ la letra de tu canci√≥n..."
                  id="letraCancion"
                ></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-zinc-300 mb-2">Prompt de estilo musical</label>
                <input 
                  type="text" 
                  class="w-full bg-zinc-900/50 border border-white/10 rounded-lg px-4 py-3 text-white"
                  placeholder="Ej: una balada emotiva con piano y cuerdas, estilo neo-soul, tempo 70 BPM"
                  id="promptEstilo"
                >
              </div>
              
              <div>
                <label class="block text-sm font-medium text-zinc-300 mb-2">Preset de generaci√≥n</label>
                <select class="w-full bg-zinc-900/50 border border-white/10 rounded-lg px-4 py-3 text-white" id="presetGeneracion">
                  <option>Profesional</option>
                  <option>Experimental</option>
                  <option>Vintage</option>
                  <option>Moderno</option>
                  <option>Cinematogr√°fico</option>
                </select>
              </div>
              
              <label class="inline-flex items-center gap-2">
                <input id="modoInstrumental" type="checkbox">
                <span class="text-sm text-zinc-300">Generar instrumental (sin voz)</span>
              </label>
            </div>
            
            <div class="space-y-6">
              <div>
                <h4 class="text-lg font-medium mb-4">Controles de Expresividad</h4>
                <div class="grid grid-cols-2 gap-4">
                  <div class="text-center">
                    <div class="knob knob-small" 
                         data-knob="afinacion" 
                         data-value="60"
                         role="slider"
                         tabindex="0"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         aria-valuenow="60"
                         aria-label="Afinaci√≥n"></div>
                    <p class="text-xs mt-1 text-zinc-400">Afinaci√≥n</p>
                    <p class="text-xs text-neon" id="afinacionDisplay">60%</p>
                  </div>
                  <div class="text-center">
                    <div class="knob knob-small" 
                         data-knob="expresividad-gen" 
                         data-value="75"
                         role="slider"
                         tabindex="0"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         aria-valuenow="75"
                         aria-label="Expresividad"></div>
                    <p class="text-xs mt-1 text-zinc-400">Expresividad</p>
                    <p class="text-xs text-neon" id="expresividadGenDisplay">75%</p>
                  </div>
                </div>
              </div>
              
              <div>
                <h4 class="text-lg font-medium mb-4">Postprocesamiento SSL/Neve</h4>
                <div class="grid grid-cols-2 gap-4 mb-4">
                  <div class="text-center">
                    <div class="knob knob-small" 
                         data-knob="low" 
                         data-value="50"
                         role="slider"
                         tabindex="0"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         aria-valuenow="50"
                         aria-label="Low"></div>
                    <p class="text-xs text-zinc-400">Low</p>
                    <p class="text-xs text-neon" id="lowDisplay">50%</p>
                  </div>
                  <div class="text-center">
                    <div class="knob knob-small" 
                         data-knob="high" 
                         data-value="50"
                         role="slider"
                         tabindex="0"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         aria-valuenow="50"
                         aria-label="High"></div>
                    <p class="text-xs text-zinc-400">High</p>
                    <p class="text-xs text-neon" id="highDisplay">50%</p>
                  </div>
                </div>
                <div>
                  <label class="text-xs text-zinc-400">Saturaci√≥n (Neve-style)</label>
                  <input type="range" class="custom-slider w-full" value="30" min="0" max="100" id="saturacion">
                  <p class="text-center text-xs text-neon mt-1" id="saturacionDisplay">30%</p>
                </div>
              </div>
              
              <button id="generarMusica" class="w-full bg-neon text-black rounded-lg py-4 font-semibold text-lg hover:bg-neon/90 transition shadow-glow btn">
                Generar M√∫sica
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECCI√ìN ARCHIVO -->
  <section id="archivo" class="content-section section-hidden min-h-screen pt-20 pb-10" aria-hidden="true">
    <div class="mx-auto max-w-7xl px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">El Archivo</h2>
        <p class="text-zinc-400 max-w-2xl mx-auto">Tu memoria creativa: canciones, presets y sesiones guardadas.</p>
      </div>
      
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="archivoGrid">
        <!-- Los archivos se cargar√°n din√°micamente -->
        <div class="rounded-xl border border-white/10 bg-white/5 p-6 hover:bg-white/10 transition">
          <div class="flex items-center justify-center h-32 mb-4">
            <span class="text-4xl">üéµ</span>
          </div>
          <p class="text-center text-zinc-400">No hay archivos guardados a√∫n</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="border-t border-white/10 py-8 mt-20">
    <div class="mx-auto max-w-7xl px-4 flex items-center justify-between">
      <div class="flex items-center space-x-6">
        <span class="text-sm text-zinc-400">¬© Son1kVers3 ‚Äî CTRL + ALT + HUMANIDAD</span>
      </div>
      <div class="flex space-x-6">
        <a href="#" class="text-sm text-zinc-400 hover:text-white transition">C√≥dex</a>
        <a href="#" class="text-sm text-zinc-400 hover:text-white transition">FAQ</a>
        <a href="#" class="text-sm text-zinc-400 hover:text-white transition">Contacto</a>
      </div>
    </div>
  </footer>

  <script>
    // Variables globales
    let currentSection = 'home';
    let backendOnline = false;
    let currentFile = null;
    let processingJobId = null;
    
    // API URL corregida para conectar con el backend en puerto 8000
    const API_BASE_URL = 
      (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') 
        ? 'http://localhost:8000' 
        : window.location.origin;
    
    // Configuraci√≥n completa de knobs con funcionalidad total
    function setupKnobs() {
      document.querySelectorAll('.knob').forEach(knob => {
        let isDragging = false;
        let startY = 0;
        let startValue = parseInt(knob.dataset.value) || 50;
        
        // Configurar ARIA
        knob.setAttribute('role', 'slider');
        knob.setAttribute('tabindex', '0');
        knob.setAttribute('aria-valuemin', '0');
        knob.setAttribute('aria-valuemax', '100');
        knob.setAttribute('aria-valuenow', startValue);
        
        // Establecer rotaci√≥n inicial
        updateKnobRotation(knob, startValue);
        updateKnobDisplay(knob.dataset.knob, startValue);
        
        // Funci√≥n para actualizar valor
        const setValue = (newValue) => {
          newValue = Math.min(100, Math.max(0, newValue));
          knob.dataset.value = newValue;
          knob.setAttribute('aria-valuenow', newValue);
          updateKnobRotation(knob, newValue);
          updateKnobDisplay(knob.dataset.knob, newValue);
        };
        
        // Mouse events
        knob.addEventListener('mousedown', (e) => {
          isDragging = true;
          startY = e.clientY;
          startValue = parseInt(knob.dataset.value) || 50;
          knob.style.cursor = 'grabbing';
          e.preventDefault();
        });
        
        // Touch events para m√≥vil
        knob.addEventListener('touchstart', (e) => {
          isDragging = true;
          startY = e.touches[0].clientY;
          startValue = parseInt(knob.dataset.value) || 50;
          e.preventDefault();
        });
        
        // Mouse move
        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          const deltaY = startY - e.clientY;
          const sensitivity = 1;
          setValue(startValue + deltaY * sensitivity);
        });
        
        // Touch move
        document.addEventListener('touchmove', (e) => {
          if (!isDragging) return;
          const deltaY = startY - e.touches[0].clientY;
          const sensitivity = 1;
          setValue(startValue + deltaY * sensitivity);
          e.preventDefault();
        });
        
        // Mouse up
        document.addEventListener('mouseup', () => {
          if (isDragging) {
            isDragging = false;
            knob.style.cursor = 'pointer';
          }
        });
        
        // Touch end
        document.addEventListener('touchend', () => {
          isDragging = false;
        });
        
        // Keyboard events
        knob.addEventListener('keydown', (e) => {
          const currentValue = parseInt(knob.dataset.value) || 50;
          
          if (['ArrowUp', 'ArrowRight'].includes(e.key)) {
            e.preventDefault();
            setValue(currentValue + 5);
          }
          if (['ArrowDown', 'ArrowLeft'].includes(e.key)) {
            e.preventDefault();
            setValue(currentValue - 5);
          }
          if (e.key === 'Home') {
            e.preventDefault();
            setValue(0);
          }
          if (e.key === 'End') {
            e.preventDefault();
            setValue(100);
          }
        });
      });
    }
    
    // Funci√≥n auxiliar para actualizar rotaci√≥n del knob
    function updateKnobRotation(knob, value) {
      const deg = -135 + (value / 100) * 270; // -135¬∞ a +135¬∞ (270¬∞ total)
      knob.style.setProperty('--rotation', `${deg}deg`);
    }
    
    // Configuraci√≥n de sliders con displays actualizados
    function setupSliders() {
      document.querySelectorAll('.custom-slider').forEach(slider => {
        const updateSlider = () => {
          const value = slider.value;
          slider.style.setProperty('--value', value + '%');
          
          // Actualizar display espec√≠fico
          const sliderId = slider.id;
          const displayId = sliderId + 'Display';
          const display = document.getElementById(displayId);
          if (display) {
            if (sliderId === 'targetLUFS') {
              display.textContent = `-${value} LUFS`;
            } else {
              display.textContent = value + '%';
            }
          }
        };
        
        slider.addEventListener('input', updateSlider);
        updateSlider(); // Inicializar
      });
    }
    
    // Actualizar displays de knobs
    function updateKnobDisplay(knobType, value) {
      const displays = {
        'expresividad': 'expresividadDisplay',
        'creatividad': 'creatividadDisplay',
        'precision': 'precisionDisplay',
        'afinacion': 'afinacionDisplay',
        'expresividad-gen': 'expresividadGenDisplay',
        'low': 'lowDisplay',
        'high': 'highDisplay'
      };
      
      const displayId = displays[knobType];
      if (displayId) {
        const display = document.getElementById(displayId);
        if (display) {
          display.textContent = Math.round(value) + '%';
        }
      }
    }
    
    // Navegaci√≥n entre secciones
    function setupNavigation() {
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
          const targetSection = e.target.dataset.section;
          showSection(targetSection);
          
          // Actualizar tabs con ARIA
          document.querySelectorAll('.nav-tab').forEach(t => {
            t.classList.remove('tab-active');
            t.setAttribute('aria-selected', 'false');
          });
          e.target.classList.add('tab-active');
          e.target.setAttribute('aria-selected', 'true');
        });
      });
    }
    
    function showSection(sectionName) {
      // Ocultar todas las secciones
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.add('section-hidden');
        section.setAttribute('aria-hidden', 'true');
      });
      
      // Mostrar la secci√≥n seleccionada
      const targetSection = document.getElementById(sectionName);
      if (targetSection) {
        targetSection.classList.remove('section-hidden');
        targetSection.setAttribute('aria-hidden', 'false');
        currentSection = sectionName;
      }
    }
    
    // Sistema robusto de conexi√≥n con backend
    async function checkBackendConnection() {
      try {
        const response = await fetch(`${API_BASE_URL}/`, {
          method: 'GET',
          timeout: 5000
        });
        
        if (response.ok) {
          backendOnline = true;
          updateBackendStatus('online', 'Conectado');
          return true;
        } else {
          throw new Error('Backend no responde correctamente');
        }
      } catch (error) {
        console.log('Backend offline:', error.message);
        backendOnline = false;
        updateBackendStatus('offline', 'Desconectado');
        return false;
      }
    }
    
    function updateBackendStatus(status, text) {
      const statusElement = document.getElementById('backend-status');
      statusElement.className = `status-indicator status-${status}`;
      statusElement.querySelector('span').textContent = text;
    }
    
    // Drag & Drop funcional para maquetas
    function setupDragDrop() {
      const dropZone = document.getElementById('maquetaDropZone');
      const fileInput = document.getElementById('maquetaUpload');
      
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
      });
      
      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
      });
      
      ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
      });
      
      function highlight() {
        dropZone.classList.add('drag-over');
      }
      
      function unhighlight() {
        dropZone.classList.remove('drag-over');
      }
      
      dropZone.addEventListener('drop', handleDrop, false);
      fileInput.addEventListener('change', handleFileSelect, false);
      
      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
      }
      
      function handleFileSelect(e) {
        const files = e.target.files;
        handleFiles(files);
      }
      
      function handleFiles(files) {
        if (files.length > 0) {
          const file = files[0];
          if (isValidAudioFile(file)) {
            currentFile = file;
            displayFileInfo(file);
            enableProcessButton();
          } else {
            showToast('Formato de archivo no soportado. Use WAV, MP3, FLAC, AIFF o M4A', 'error');
          }
        }
      }
      
      function isValidAudioFile(file) {
        const validTypes = ['audio/wav', 'audio/mp3', 'audio/mpeg', 'audio/flac', 'audio/aiff', 'audio/m4a'];
        return validTypes.includes(file.type) || file.name.match(/\.(wav|mp3|flac|aiff|m4a)$/i);
      }
      
      function displayFileInfo(file) {
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        
        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
        fileInfo.classList.remove('hidden');
        
        document.getElementById('removeFile').addEventListener('click', removeFile);
      }
      
      function removeFile() {
        currentFile = null;
        document.getElementById('fileInfo').classList.add('hidden');
        fileInput.value = '';
        disableProcessButton();
      }
      
      function enableProcessButton() {
        document.getElementById('procesarMaqueta').disabled = false;
      }
      
      function disableProcessButton() {
        document.getElementById('procesarMaqueta').disabled = true;
      }
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Funci√≥n para procesar maqueta con el backend
    async function procesarMaqueta() {
      if (!currentFile || !backendOnline) {
        showToast('Selecciona un archivo y aseg√∫rate de que el backend est√© conectado', 'warning');
        return;
      }
      
      try {
        const formData = new FormData();
        formData.append('audio_file', currentFile);
        formData.append('user_vision', document.getElementById('visionUsuario').value);
        formData.append('preset', document.getElementById('presetProduccion').value);
        formData.append('target_lufs', document.getElementById('targetLUFS').value);
        formData.append('warmth', document.getElementById('warmth').value);
        
        showProgressSection();
        updateProgress(0, 'Subiendo archivo...');
        
        const response = await fetch(`${API_BASE_URL}/ghost/maqueta/process`, {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.job_id) {
          processingJobId = data.job_id;
          pollProcessingStatus(data.job_id);
        } else if (data.analysis) {
          showAnalysisResults(data.analysis);
          showABComparison(data.original_url, data.production_url);
        }
        
      } catch (error) {
        console.error('Error procesando maqueta:', error);
        showToast('Error al procesar maqueta: ' + error.message, 'error');
        hideProgressSection();
      }
    }
    
    // Polling del estado de procesamiento
    async function pollProcessingStatus(jobId) {
      try {
        const response = await fetch(`${API_BASE_URL}/jobs/${jobId}/status`);
        const data = await response.json();
        
        if (data.status === 'completed') {
          showAnalysisResults(data.analysis);
          showABComparison(data.original_url, data.production_url);
          hideProgressSection();
          showToast('Procesamiento completado exitosamente', 'success');
        } else if (data.status === 'failed') {
          hideProgressSection();
          showToast('Error en el procesamiento', 'error');
        } else {
          // Actualizar progreso
          updateProgress(data.progress || 50, data.stage || 'Procesando...');
          // Continuar polling
          setTimeout(() => pollProcessingStatus(jobId), 2000);
        }
      } catch (error) {
        console.error('Error en polling:', error);
        setTimeout(() => pollProcessingStatus(jobId), 5000);
      }
    }
    
    function showProgressSection() {
      document.getElementById('progressSection').classList.remove('hidden');
    }
    
    function hideProgressSection() {
      document.getElementById('progressSection').classList.add('hidden');
    }
    
    function updateProgress(percentage, text) {
      document.getElementById('progressFill').style.width = percentage + '%';
      document.getElementById('progressText').textContent = text;
    }
    
    function showAnalysisResults(analysis) {
      document.getElementById('tempoValue').textContent = Math.round(analysis.tempo) + ' BPM';
      document.getElementById('keyValue').textContent = analysis.key;
      document.getElementById('energyValue').textContent = Math.round(analysis.energy * 100) + '%';
      document.getElementById('vocalValue').textContent = analysis.vocal_presence ? 'Detectado' : 'No detectado';
      
      document.getElementById('analysisResults').classList.remove('hidden');
    }
    
    function showABComparison(originalUrl, productionUrl) {
      // Configurar reproductores de audio
      document.getElementById('playOriginal').onclick = () => playAudio(originalUrl);
      document.getElementById('playProduction').onclick = () => playAudio(productionUrl);
      document.getElementById('downloadProduction').onclick = () => downloadAudio(productionUrl);
      
      document.getElementById('abComparison').classList.remove('hidden');
    }
    
    function playAudio(url) {
      const player = document.getElementById('player');
      player.src = url;
      player.play().catch(error => {
        console.error('Error playing audio:', error);
        showToast('Error al reproducir audio', 'error');
      });
    }
    
    function downloadAudio(url) {
      const a = document.createElement('a');
      a.href = url;
      a.download = 'son1k_production.wav';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    
    // Funci√≥n para generar m√∫sica
    async function generarMusica() {
      if (!backendOnline) {
        showToast('Backend desconectado. Conecta el servidor primero.', 'warning');
        return;
      }
      
      try {
        const esInstrumental = document.getElementById('modoInstrumental').checked;
        const letra = document.getElementById('letraCancion').value.trim();
        const estilo = document.getElementById('promptEstilo').value.trim();
        
        if (!esInstrumental && !letra && !estilo) {
          showToast('Ingresa letra o prompt de estilo, o activa modo instrumental', 'warning');
          return;
        }
        
        const btn = document.getElementById('generarMusica');
        btn.disabled = true;
        btn.textContent = 'Generando...';
        
        // Recopilar par√°metros de los knobs
        const params = {
          instrumental: esInstrumental,
          lyrics: letra,
          style: estilo,
          preset: document.getElementById('presetGeneracion').value,
          afinacion: parseInt(document.querySelector('[data-knob="afinacion"]').dataset.value),
          expresividad: parseInt(document.querySelector('[data-knob="expresividad-gen"]').dataset.value),
          eq_low: parseInt(document.querySelector('[data-knob="low"]').dataset.value),
          eq_high: parseInt(document.querySelector('[data-knob="high"]').dataset.value),
          saturacion: parseInt(document.getElementById('saturacion').value)
        };
        
        const response = await fetch(`${API_BASE_URL}/api/generate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(params)
        });
        
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.job_id) {
          pollGenerationJob(data.job_id);
        } else if (data.audio_url) {
          showToast('M√∫sica generada exitosamente', 'success');
          // Agregar al archivo
          addToArchive(data);
        }
        
      } catch (error) {
        console.error('Error:', error);
        showToast('Error al generar m√∫sica: ' + error.message, 'error');
      } finally {
        const btn = document.getElementById('generarMusica');
        btn.disabled = false;
        btn.textContent = 'Generar M√∫sica';
      }
    }
    
    async function pollGenerationJob(jobId) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/jobs/${jobId}`);
        const data = await response.json();
        
        if (data.status === 'completed') {
          showToast('M√∫sica generada exitosamente', 'success');
          addToArchive(data);
        } else if (data.status === 'failed') {
          showToast('Error al generar m√∫sica', 'error');
        } else {
          // Continuar polling
          setTimeout(() => pollGenerationJob(jobId), 2000);
        }
      } catch (error) {
        console.error('Error en polling:', error);
        setTimeout(() => pollGenerationJob(jobId), 5000);
      }
    }
    
    function addToArchive(data) {
      // Implementar funci√≥n para agregar al archivo
      console.log('Agregando al archivo:', data);
    }
    
    // Sistema de notificaciones mejorado
    function showToast(message, type = 'info') {
      const toastArea = document.getElementById('toast-area');
      const toast = document.createElement('div');
      
      const colors = {
        'success': 'bg-green-600',
        'error': 'bg-red-600', 
        'warning': 'bg-yellow-600',
        'info': 'bg-blue-600'
      };
      
      toast.className = `px-6 py-3 rounded-lg shadow-lg text-white font-medium transform transition-all duration-300 translate-x-full ${colors[type] || colors.info}`;
      toast.textContent = message;
      
      toastArea.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.remove('translate-x-full');
      }, 100);
      
      setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => {
          if (toast.parentNode) {
            toastArea.removeChild(toast);
          }
        }, 300);
      }, 3000);
    }
    
    // Event listeners principales
    function setupEventListeners() {
      // Navegaci√≥n
      document.getElementById('entrarEstudio').addEventListener('click', () => {
        showSection('ghost-studio');
        document.querySelectorAll('.nav-tab').forEach(t => {
          t.classList.remove('tab-active');
          t.setAttribute('aria-selected', 'false');
        });
        const tab = document.querySelector('[data-section="ghost-studio"]');
        tab.classList.add('tab-active');
        tab.setAttribute('aria-selected', 'true');
      });
      
      document.getElementById('entrarEstudioMain').addEventListener('click', () => {
        showSection('ghost-studio');
        document.querySelectorAll('.nav-tab').forEach(t => {
          t.classList.remove('tab-active');
          t.setAttribute('aria-selected', 'false');
        });
        const tab = document.querySelector('[data-section="ghost-studio"]');
        tab.classList.add('tab-active');
        tab.setAttribute('aria-selected', 'true');
      });
      
      // Botones de procesamiento
      document.getElementById('procesarMaqueta').addEventListener('click', procesarMaqueta);
      document.getElementById('generarMusica').addEventListener('click', generarMusica);
      
      // Tests r√°pidos
      document.getElementById('testRapido').addEventListener('click', async () => {
        updateBackendStatus('processing', 'Probando...');
        const isOnline = await checkBackendConnection();
        if (isOnline) {
          showToast('Conexi√≥n exitosa con el backend', 'success');
        } else {
          showToast('Backend no disponible', 'error');
        }
      });
      
      document.getElementById('generarPreview').addEventListener('click', () => {
        if (backendOnline) {
          showToast('Generando preview con par√°metros actuales...', 'info');
        } else {
          showToast('Conecta el backend primero', 'warning');
        }
      });
    }
    
    // Inicializaci√≥n completa
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('Inicializando Son1kVers3...');
      
      // Setup de componentes
      setupKnobs();
      setupSliders();
      setupNavigation();
      setupDragDrop();
      setupEventListeners();
      
      // Inicializar sistema de tiers (Free por defecto)
      setUserTier('free');
      
      // Verificar conexi√≥n con backend
      updateBackendStatus('processing', 'Conectando...');
      const isOnline = await checkBackendConnection();
      
      if (isOnline) {
        console.log('Backend conectado exitosamente');
        setTimeout(() => {
          showToast('Son1kVers3 listo - Resistencia Sonora Activa', 'success');
        }, 1000);
      } else {
        console.log('Modo demo - backend no disponible');
        setTimeout(() => {
          showToast('Modo demo - Inicia el backend para funcionalidad completa', 'warning');
        }, 1000);
      }
      
      // Verificar conexi√≥n peri√≥dicamente
      setInterval(checkBackendConnection, 30000);
    });
  </script>
</body>
</html>
